<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mavrixfy Audio Production Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .test-section {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        button {
            background: #22c55e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #16a34a;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #065f46; border: 1px solid #10b981; }
        .error { background: #7f1d1d; border: 1px solid #ef4444; }
        .warning { background: #78350f; border: 1px solid #f59e0b; }
        .info { background: #1e3a8a; border: 1px solid #3b82f6; }
        #results {
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üéµ Mavrixfy Audio Production Test</h1>
    
    <div class="test-section">
        <h2>Quick Audio Test</h2>
        <p>This tests basic audio functionality that should work in production.</p>
        
        <button onclick="testBasicAudio()">Test Basic Audio</button>
        <button onclick="testHTTPSAudio()">Test HTTPS Audio</button>
        <button onclick="testUserInteraction()">Test User Interaction</button>
        <button onclick="runAllTests()">Run All Tests</button>
        
        <div id="status"></div>
    </div>

    <div class="test-section">
        <h2>Production Audio Player Test</h2>
        <p>Test the actual audio player with production-safe configuration.</p>
        
        <div style="margin: 20px 0;">
            <audio id="testAudio" controls style="width: 100%;">
                Your browser does not support the audio element.
            </audio>
        </div>
        
        <button onclick="loadTestAudio()">Load Test Audio</button>
        <button onclick="playAudio()">Play Audio</button>
        <button onclick="pauseAudio()">Pause Audio</button>
        
        <div id="audioStatus"></div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <script>
        let hasUserInteracted = false;
        let testResults = [];

        // Track user interaction
        document.addEventListener('click', () => {
            hasUserInteracted = true;
        }, { once: true });

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        function testBasicAudio() {
            log('Testing basic audio functionality...', 'info');
            
            try {
                const audio = document.createElement('audio');
                
                // Configure for production
                audio.setAttribute('playsinline', 'true');
                audio.setAttribute('webkit-playsinline', 'true');
                audio.crossOrigin = 'anonymous';
                audio.muted = false;
                audio.volume = 1.0;
                
                // Test with data URL (should always work)
                audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
                
                audio.oncanplay = () => {
                    log('‚úÖ Basic audio loading successful', 'success');
                    testResults.push({ test: 'Basic Audio', result: 'PASS' });
                };
                
                audio.onerror = (e) => {
                    log('‚ùå Basic audio loading failed: ' + (audio.error ? audio.error.message : 'Unknown error'), 'error');
                    testResults.push({ test: 'Basic Audio', result: 'FAIL' });
                };
                
                audio.load();
                
            } catch (error) {
                log('‚ùå Basic audio test error: ' + error.message, 'error');
                testResults.push({ test: 'Basic Audio', result: 'ERROR' });
            }
        }

        function testHTTPSAudio() {
            log('Testing HTTPS audio loading...', 'info');
            
            try {
                const audio = document.createElement('audio');
                audio.crossOrigin = 'anonymous';
                
                // Test with HTTPS URL
                const testUrl = 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav';
                
                const timeout = setTimeout(() => {
                    log('‚ö†Ô∏è HTTPS audio test timed out', 'warning');
                    testResults.push({ test: 'HTTPS Audio', result: 'TIMEOUT' });
                }, 10000);
                
                audio.onloadedmetadata = () => {
                    clearTimeout(timeout);
                    log('‚úÖ HTTPS audio loaded successfully', 'success');
                    testResults.push({ test: 'HTTPS Audio', result: 'PASS' });
                };
                
                audio.onerror = () => {
                    clearTimeout(timeout);
                    log('‚ùå HTTPS audio loading failed (may be CORS issue)', 'error');
                    testResults.push({ test: 'HTTPS Audio', result: 'FAIL' });
                };
                
                audio.src = testUrl;
                audio.load();
                
            } catch (error) {
                log('‚ùå HTTPS audio test error: ' + error.message, 'error');
                testResults.push({ test: 'HTTPS Audio', result: 'ERROR' });
            }
        }

        function testUserInteraction() {
            log('Testing user interaction requirement...', 'info');
            
            try {
                const audio = document.createElement('audio');
                audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
                
                const playPromise = audio.play();
                
                if (playPromise) {
                    playPromise
                        .then(() => {
                            audio.pause();
                            if (hasUserInteracted) {
                                log('‚úÖ User interaction properly detected', 'success');
                                testResults.push({ test: 'User Interaction', result: 'PASS' });
                            } else {
                                log('‚ö†Ô∏è Autoplay worked without user interaction (unexpected)', 'warning');
                                testResults.push({ test: 'User Interaction', result: 'WARNING' });
                            }
                        })
                        .catch(() => {
                            if (hasUserInteracted) {
                                log('‚ö†Ô∏è Play failed despite user interaction', 'warning');
                                testResults.push({ test: 'User Interaction', result: 'WARNING' });
                            } else {
                                log('‚úÖ Autoplay properly blocked without user interaction', 'success');
                                testResults.push({ test: 'User Interaction', result: 'PASS' });
                            }
                        });
                } else {
                    log('‚ùå Audio play method not supported', 'error');
                    testResults.push({ test: 'User Interaction', result: 'FAIL' });
                }
                
            } catch (error) {
                log('‚ùå User interaction test error: ' + error.message, 'error');
                testResults.push({ test: 'User Interaction', result: 'ERROR' });
            }
        }

        function runAllTests() {
            log('Running comprehensive audio tests...', 'info');
            testResults = [];
            
            testBasicAudio();
            setTimeout(() => testHTTPSAudio(), 1000);
            setTimeout(() => testUserInteraction(), 2000);
            
            setTimeout(() => {
                log('\n=== TEST SUMMARY ===', 'info');
                testResults.forEach(result => {
                    log(`${result.test}: ${result.result}`, result.result === 'PASS' ? 'success' : 'error');
                });
                
                const passed = testResults.filter(r => r.result === 'PASS').length;
                const total = testResults.length;
                log(`\nPassed: ${passed}/${total}`, passed === total ? 'success' : 'warning');
            }, 5000);
        }

        // Production audio player test functions
        function loadTestAudio() {
            const audio = document.getElementById('testAudio');
            
            // Configure for production
            audio.setAttribute('playsinline', 'true');
            audio.setAttribute('webkit-playsinline', 'true');
            audio.crossOrigin = 'anonymous';
            audio.muted = false;
            audio.volume = 1.0;
            
            // Load test audio
            audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
            
            const audioStatus = document.getElementById('audioStatus');
            audioStatus.className = 'status info';
            audioStatus.textContent = 'Test audio loaded. Click play to test.';
        }

        function playAudio() {
            const audio = document.getElementById('testAudio');
            const audioStatus = document.getElementById('audioStatus');
            
            audio.play()
                .then(() => {
                    audioStatus.className = 'status success';
                    audioStatus.textContent = '‚úÖ Audio playing successfully!';
                })
                .catch((error) => {
                    audioStatus.className = 'status error';
                    audioStatus.textContent = '‚ùå Play failed: ' + error.message;
                });
        }

        function pauseAudio() {
            const audio = document.getElementById('testAudio');
            const audioStatus = document.getElementById('audioStatus');
            
            audio.pause();
            audioStatus.className = 'status info';
            audioStatus.textContent = 'Audio paused.';
        }

        // Initialize
        log('Audio test page loaded. Browser: ' + navigator.userAgent.split(' ').pop(), 'info');
        log('HTTPS: ' + (window.location.protocol === 'https:' ? 'Yes' : 'No'), 'info');
        log('User Agent: ' + navigator.userAgent, 'info');
    </script>
</body>
</html>