<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="theme-color" content="#1DB954" media="(prefers-color-scheme: light)" />
		<meta name="theme-color" content="#191414" media="(prefers-color-scheme: dark)" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="apple-mobile-web-app-title" content="Spotify Clone" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<meta name="msapplication-TileColor" content="#1DB954" />
		<meta name="msapplication-config" content="/browserconfig.xml" />
		
		<title>Spotify Clone</title>
		
		<!-- Preconnect to external domains for faster loading -->
		<link rel="preconnect" href="https://firebase.googleapis.com" crossorigin>
		<link rel="preconnect" href="https://spotify-8fefc.firebaseapp.com" crossorigin>
		<link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
		<link rel="preconnect" href="https://api.spotify.com" crossorigin>
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<!-- DNS prefetch for additional domains -->
		<link rel="dns-prefetch" href="//res.cloudinary.com">
		<link rel="dns-prefetch" href="//api.spotify.com">
		<link rel="dns-prefetch" href="//fonts.googleapis.com">
		<link rel="dns-prefetch" href="//fonts.gstatic.com">
		
		<!-- Mobile-specific preloads -->
		<link rel="preload" href="/assets/critical.css" as="style">
		<link rel="preload" href="/assets/critical.js" as="script">
		
		<!-- Spotify Web Playback SDK: load after idle to avoid affecting FCP/LCP -->
		<script>
			// Mobile performance optimizations
			if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
				// Mobile-specific optimizations
				document.documentElement.classList.add('mobile-device');
				
				// Reduce animation complexity on mobile
				const style = document.createElement('style');
				style.textContent = `
					@media (max-width: 768px) {
						* { animation-duration: 0.1s !important; transition-duration: 0.1s !important; }
						.mobile-optimized { transform: translateZ(0); will-change: auto; }
					}
				`;
				document.head.appendChild(style);
			}
		</script>
		
		<!-- Critical CSS inline for mobile -->
		<style>
			/* Mobile-first critical CSS */
			* { box-sizing: border-box; }
			body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
			.mobile-device { -webkit-text-size-adjust: 100%; -webkit-tap-highlight-color: transparent; }
			.mobile-device * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
			.mobile-device input, .mobile-device textarea { -webkit-user-select: text; user-select: text; }
			
			/* Mobile-safe-area support */
			.mobile-device { padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
			
			/* Mobile touch targets */
			@media (max-width: 768px) {
				button, a, input, select, textarea { min-width: 44px; min-height: 44px; }
			}
		</style>
	</head>
	<body>
		<div id="root"></div>
		<script type="module" src="/src/main.tsx"></script>
		
		<!-- Mobile-specific scripts -->
		<script>
			// Mobile performance monitoring
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register('/service-worker.js')
						.then(registration => console.log('SW registered for mobile'))
						.catch(error => console.log('SW registration failed'));
				});
			}
			
			// Mobile-specific performance metrics
			if (window.performance && window.performance.mark) {
				window.performance.mark('mobile-app-start');
			}
			
			// Dynamic PWA theme color matching with homepage
			function updatePWAThemeColors() {
				const isDark = document.documentElement.classList.contains('dark');
				const themeColor = isDark ? '#191414' : '#ffffff';
				const statusBarStyle = isDark ? 'black-translucent' : 'default';
				
				// Update theme-color meta tag
				const themeMeta = document.querySelector('meta[name="theme-color"]');
				if (themeMeta) {
					themeMeta.setAttribute('content', themeColor);
				}
				
				// Update Apple status bar style
				const appleMeta = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
				if (appleMeta) {
					appleMeta.setAttribute('content', statusBarStyle);
				}
				
				// Update body background to match homepage
				document.body.style.backgroundColor = themeColor;
				document.body.style.transition = 'background-color 0.3s ease';
			}
			
			// Initial theme color update
			updatePWAThemeColors();
			
			// Watch for theme changes
			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
						updatePWAThemeColors();
					}
				});
			});
			
			observer.observe(document.documentElement, {
				attributes: true,
				attributeFilter: ['class']
			});
		</script>
	</body>
</html>
