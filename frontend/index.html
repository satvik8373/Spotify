<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-FQJS8LREP5"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-FQJS8LREP5');
		</script>
		
		<!-- Google AdSense -->
		<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6003470714469240"
		     crossorigin="anonymous"></script>
		
		<meta charset="UTF-8" />
		<link rel="icon" type="image/png" href="/mavrixfy.png" />
		
		<!-- PWA Icons for Add to Home Screen -->
		<link rel="apple-touch-icon" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="96x96" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="128x128" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="152x152" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="180x180" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="192x192" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="384x384" href="/mavrixfy.png" />
		<link rel="apple-touch-icon" sizes="512x512" href="/mavrixfy.png" />
		
		<!-- Android/Chrome PWA Icons -->
		<link rel="icon" type="image/png" sizes="72x72" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="96x96" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="128x128" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="144x144" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="152x152" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="192x192" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="384x384" href="/mavrixfy.png" />
		<link rel="icon" type="image/png" sizes="512x512" href="/mavrixfy.png" />
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		
		<!-- Prevent caching in WebView -->
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		
		<meta name="theme-color" content="#1DB954" media="(prefers-color-scheme: light)" />
		<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="apple-mobile-web-app-title" content="Mavrixfy" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<meta name="msapplication-TileColor" content="#1DB954" />
		<meta name="msapplication-config" content="/browserconfig.xml" />
		
		<title>Mavrixfy</title>
		
		<!-- PWA Manifest -->
		<link rel="manifest" href="/manifest.json" />
		
		<!-- Preconnect to external domains for faster loading -->
		<link rel="preconnect" href="https://firebase.googleapis.com" crossorigin>
		<link rel="preconnect" href="https://spotify-8fefc.firebaseapp.com" crossorigin>
		<link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
		<link rel="preconnect" href="https://api.spotify.com" crossorigin>
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<!-- DNS prefetch for additional domains -->
		<link rel="dns-prefetch" href="//res.cloudinary.com">
		<link rel="dns-prefetch" href="//api.spotify.com">
		<link rel="dns-prefetch" href="//fonts.googleapis.com">
		<link rel="dns-prefetch" href="//fonts.gstatic.com">
		
		<!-- Remove unused generic preloads to avoid wasting bandwidth -->
		
		<!-- Spotify Web Playback SDK: load after idle to avoid affecting FCP/LCP -->
		<script>
			// Mobile performance optimizations
			if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
				// Mobile-specific optimizations
				document.documentElement.classList.add('mobile-device');
				
				// Reduce animation complexity on mobile
				const style = document.createElement('style');
				style.textContent = `
					@media (max-width: 768px) {
						* { animation-duration: 0.1s !important; transition-duration: 0.1s !important; }
						.mobile-optimized { transform: translateZ(0); will-change: auto; }
					}
				`;
				document.head.appendChild(style);
			}
		</script>
		
		<!-- Critical CSS inline for mobile -->
		<style>
			/* Mobile-first critical CSS */
			* { box-sizing: border-box; }
			body { 
				margin: 0; 
				padding: 0; 
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				background-color: #121212 !important; /* Prevent white flicker */
				color: white;
			}
			html { background-color: #121212 !important; } /* Prevent white flicker */
			.mobile-device { -webkit-text-size-adjust: 100%; -webkit-tap-highlight-color: transparent; }
			.mobile-device * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
			.mobile-device input, .mobile-device textarea { -webkit-user-select: text; user-select: text; }
			
			/* Mobile-safe-area support */
			.mobile-device { padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
			
			/* Mobile touch targets */
			@media (max-width: 768px) {
				button, a, input, select, textarea { min-width: 44px; min-height: 44px; }
			}
			
			/* Smooth fade animation */
			@keyframes fadeIn {
				from { opacity: 0; }
				to { opacity: 1; }
			}
			
			/* YouTube-like skeleton animation - slower and smoother */
			@keyframes skeletonPulse {
				0% { 
					opacity: 1; 
					transform: translateX(0);
				}
				50% { 
					opacity: 0.6; 
					transform: translateX(0);
				}
				100% { 
					opacity: 1; 
					transform: translateX(0);
				}
			}
			
			.skeleton-pulse {
				animation: skeletonPulse 2.5s ease-in-out infinite;
				background: rgba(255, 255, 255, 0.1);
			}
		</style>
	</head>
	<body>
		<div id="root"></div>
		<script type="module" src="/src/main.tsx"></script>
		
		<!-- Mobile-specific scripts -->
		<script>
			// Mobile performance monitoring
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register('/service-worker.js')
						.catch(() => {});
				});
			}
			
			// Mobile-specific performance metrics
			if (window.performance && window.performance.mark) {
				window.performance.mark('mobile-app-start');
			}
			
			// Dynamic PWA theme color matching with homepage
			function updatePWAThemeColors() {
				const isDark = document.documentElement.classList.contains('dark');
				const themeColor = '#121212'; // Always use dark theme color
				const statusBarStyle = 'black-translucent'; // Always use dark status bar
				
				// Update theme-color meta tag
				const themeMeta = document.querySelector('meta[name="theme-color"]');
				if (themeMeta) {
					themeMeta.setAttribute('content', themeColor);
				}
				
				// Update Apple status bar style
				const appleMeta = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
				if (appleMeta) {
					appleMeta.setAttribute('content', statusBarStyle);
				}
				
				// Update body background to match homepage - always dark
				document.body.style.backgroundColor = themeColor;
				document.body.style.transition = 'background-color 0.3s ease';
			}
			
			// Initial theme color update
			updatePWAThemeColors();
			
			// Watch for theme changes
			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
						updatePWAThemeColors();
					}
				});
			});
			
			observer.observe(document.documentElement, {
				attributes: true,
				attributeFilter: ['class']
			});
		</script>
	</body>
</html>
